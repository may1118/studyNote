# XMLHttpRequest实现

[TOC]

"**XMLHttpRequest**"提供了从Web服务器获取数据的能力，如果想更新某条数据，只需要通过XMLHttpRequest请求服务器提供的接口，就可以获取到服务器的数据‘

## 回调函数VS系统调用栈

“**回调函数：**”将一个函数**作为参数**传递给另外一个函数，那作为参数的这个函数就是“**回调函数**”

“**系统调用栈：**”例如：parse HTML是一个完整的任务，在执行过程中的脚本解析、样式表解析都是该任务的子过程

## XMLHttpRequest运作机制

![](I:\myFuture\桌面资料\面试\学习图片\XMLHttpRequest工作流程图.png)

### 1. 创建XMLHttpRequest对象

```js
var xhr = new XMLHttpRequest();
```

### 2. 为xhr对象注册回调函数

因为网络请求比较耗时，所以要注册回调函数，这样后台任务执行完成之后就会通过回调函数告诉其执行结果。

XMLHttpRequest的回调函数：

| 名称               | 作用                                                         |
| ------------------ | ------------------------------------------------------------ |
| ontimeout          | 监控请求超时                                                 |
| onerror            | 监控出错信息                                                 |
| onreadystatechange | 监控后台请求过程中的状态，例如：HTTP头加载完成信息、HTTP响应体消息以及数据加载完成的消息等 |

### 3. 配置基础的请求信息

1. 通过open接口配置一些基础的请求信息，包括请求的地址、请求方法、请求方式
2. 通过xhr内部属性类配置一些其他可选的请求参数

### 4. 发起请求

```js
xhr.send();
```

渲染进程会将请求发送给网络进程，然后网络进程负责资源的下载，等网络进程接收数据之后，就会利用IPC来告知渲染进程，渲染进程接收到消息之后，会将xhr的回调函数封装成任务添加到消息队列中，等主线程循环系统执行到该任务的时候，就会根据相关的状态来调用对应的回调函数。

## 使用XMLHttpRequest注意事项

### 跨域问题

### HTTPS混合内容的问题

