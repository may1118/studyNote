# HTTP重定向和跳转

[TOC]

## 重定向过程

“**重定向**”实际发送了两次HTTP请求，第一次返回了302，然后第二次请求被重定向到了指定路径。重定向用户是“无感知”的

第一个请求返回的响应报文：

- “**Location：/login.html**”

浏览器收到301/302报文，会检查响应头有没有“**Location**”。如果有，就直接从字段值里取出URI，发出新的HTTP请求

“**Location**”既支持相对定位也支持绝对定位

## 状态码

- “**301 Moved Permanently**”，永久重定向
  - 浏览器看到301，知道原来的URI过时了，就会适当的优化。下再在进行访问，可能就直接使用新的URI访问，省去了再次跳转的成本。
- “**302 Moved Temporarily**”，临时重定向
  - URI处于“**临时维护**”状态，新的URI是起“顶包”作用的临时URI，浏览器/网络爬虫看到302，会认为原来的URI任然有效，但暂时不可用，所以只会执行简单的页面跳转，不会记录新的URI，也不会有其他的多余动作，下再访问还是用原来的URI
- “**303 See Other**”，类似302，但是重定向后请求方法改为GET方法，访问一个结果页面，避免POST/PUT重复动作
- “**307 Temporary Redirect**”，类似302，但重定向后请求里的方法和实体不允许变动，含义比302更明确
- “**308 Permanent Redirect**”，类似307，不允许重定向的请求变动，但是是301“**永久重定向**”的含义

不过这三个状态码的接收程度较低，需要验证浏览器是否支持才能使用

## 场景

- 域名变更、服务器变更、网站改版、系统维护，这些都会导致原URI指向的资源无法访问，为了避免出现404，就需要使用重定向转跳到新的URI
- 301
  - 域名、服务器、网站架构发生了大幅度的改变，比如启用了新的域名、服务器切到了新的机房、网站目录层次重构，这些都算是“永久性”的改变。原来的URI不能用了，必须用301“**永久重定向**”
- 302
  - 网站在将来的某个时间点会恢复正常，常见的应用场景就是系统维护，把网站重定向到一个通知页面，告诉用户过一会儿再来访问。
  - 服务降级，暂时关闭一些服务，保证核心服务正常运行

## 缺点

**缺点：**

- **性能损耗**，需要进行两次跳转，比正常的访问多了一次
- **循环跳转**，应该尽量的避免循环跳转的出现。