# HTTP/2

[TOC]

## 头部压缩

HTTP/2并没有使用传统的压缩算法，而是开发了专门的“**HPACK**”算法，在**客户端和服务端两端建立“字典”**，用索引号标识重复的字符串，还采用了哈夫曼编码来压缩整数和字符串，可以达到50%-90%的高压缩率

## 二进制格式

不再使用ASCII码，而是向下层TCP/IP协议“**靠拢**”，全面采用二进制格式。

虽然对人不友好，但却大大方便了计算机的解析。原来使用纯文本的内容容易出现**多义性**，但是二进制只有0/1，可以严格规定字段大小、顺序、标志位等格式，没有起义，实现简单，而且体积小，速度快，做到“内部提效”。

header+body的消息打散成数个小片的“**二进制“帧”**”，用“**HEADERS**”帧存放数据，“**DATA**”帧存放实体数据。

## 虚拟的“流”

消息的**碎片**到达目的地之后应该如何组装起来？

HTTP/2为此定义了一个“**流（Stream）**”的概念，它是二进制帧的双向传输序列，同一个消息往返帧回分配一个唯一的流ID。可以想象成虚拟的“数据流”，在里面流动的是一串有先后顺序的数据帧，这些数据帧按照次序组装起来就是HTTP/1里的请求报文和响应报文。

因为“**流**”是虚拟的，实际上并不存在，所以HTTP/2就可以在一个TCP连接上用“**流**”同时发送多个“碎片化”的信息，这就是常说的“**多路复用**”——多个往返通信都复用一个连接来处理。

在“**流**”的层面上看，消息是一些有序的“帧”序列，而在“连接”的层面上看，消息确实乱序发送的“帧”。多个请求/响应之间没有了顺序关系，不需要排队等待，也就不会出现“队头阻塞”问题，降低了延迟，大幅度提高了连接的使用率。

![](I:\myFuture\桌面资料\面试\学习图片\二进制流.png)

为了更好的利用连接，加大吞吐量，HTTP/2还添加了一些控制帧来关系虚拟的“流”，实现了优先级和流量控制，这些特性和TCP协议非常相似。

HTTP/2还在一定程度上改变了传统的“请求-应答”工作模式，服务器不再是完全被动地响应请求，也可以新建“流”主动向客户端发送消息。比如：在浏览器刚请求HTML的时候，就提前把可能会用到的JS、CSS文件发送给客户端，减少等待的延迟，这称为“**服务器推送**”

## 强化安全

要求至少是TLS1.2，而且禁止了很多不安全的密码套件。

![](I:\myFuture\桌面资料\面试\学习图片\HTTP协议栈.png)

## HTTP/2缺点

- HTTP/2对一个域名只开一个连接，一旦这个连接出现问题，那么整个网站的体验也会变得差了
- 如果发生丢包，HPACK字典都消失，必须重头开始计算，导致带宽浪费和时延