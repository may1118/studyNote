# HTTP性能优化

[TOC]

硬件软件、内部外部、花钱不花钱

- 购买更好的硬件：CPU、网卡、带宽、服务器
- 购买外部的软件或者服务：CDN

<hr />
**不花钱**

## 开源

- 使用高性能的Web服务器
- 启用长连接：connect：keep-alive
- TCP Fast Open

## 节流

- gzip和br算法压缩
- HTML/CSS/JS，压缩去掉多余的空格、换行、注释等
- 资源合并的优化
- 减少header地大小，不必要地字段就尽量不发
- Cookie设置domain和path属性，限定Cookie的作用域
- 或者使用Web LocalStorage
- 适当“压缩”域名，限制在2-3个作用，减少解析完整域名所需时间
- 避免重定向，或者Web服务器“内部重定向”

## 缓存

- 服务器内部可以使用Memcache、Redis、Varnish
- CDN缓存加速
- 为资源添加ETag、Last-Modified字段，再用Cache-Control、Expires设置号缓存控制属性
  - “没有请求的请求，才是最快的请求”

## HTTP/2

一些在HTTP/1里的优化手段到了HTTP/2里会有“反效果”

- HTTP/2中，一个域名使用一个TCP连接才能够获得最佳性能，如果开了多个域名，就会浪费带宽和服务器资源，也会降低HTTP/2的效率
  - 所以：“域名收缩“在HTTP/2里是必须要做的
- HTTP/2里因为有头部压缩和多路复用，传输小文件的成本很低，所以合并就失去了意义。而且”资源合并“还有一个缺点，就是降低了缓存的可用性，只要一个小文件更新，整个缓存就完全失效，必须重新下载。
  - 所以在现在的大带宽和CDN应用场景下，应当尽量少用资源合并，让资源的粒度尽可能地小，才能更好地发挥缓存地作用。

