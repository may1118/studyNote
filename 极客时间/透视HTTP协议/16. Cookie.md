# Cookie

[TOC]

HTTP是无状态的，这既是优点也是缺点。

- 优点：服务器没有状态差异，容易组成集群
- 缺点：无法支持需要记录状态的事务操作

Cookie的机制就是：既然服务器记不住，那么在外部向办法记住。

## 工作过程

- 请求头字段：“**Cookie**”
- 响应头字段：“**Set-Cookie**”
  - 一种“**key=value**”的格式，随着响应报文以通发给浏览器

浏览器收到响应报文，看到里面有**Set-Cookie**，知道这是服务器的身份标识，于是保存起来，下次再请求的时候自动把这个值放进Cookie字段里发给服务器

## Cookie属性

### 有效期

- “**Expires**”和“**Max-Age**”
  - **Expires**：过期时间，用的是绝对时间点，可以理解成“截至日期”
  - “**Max-Age**”：用的是相对时间，单位是秒（s），浏览器收到报文的时间点再加上Max-Age，就可以得到失效的绝对时间

同时存在，浏览器会优先采用“**Max-Age**”计算失效期

### 作用域

- “**Domain**”和“**Path**”

### 安全性

- "**HttpOnly**"：告诉浏览器Cookie只能通过浏览器协议传输，禁止其他方式访问，浏览器的**JavaScript**引擎就会禁用"**document.cookie**"等一切相关API，脚本攻击也就无从谈起了
- "**SameSite**"：可以防范“**跨站脚本攻击CSRF**”
  - Strict：严格限定Cookie不能随着跳转链接跨站发送，只允许本站携带
  - Lax：允许GET/HEAD方法，a链接、link加载、GET表单
    - 默认
  - None：没有限制
- “**Secure**”：cookie只能用HTTPS协议加密传输，明文的HTTP协议会禁止发送

## 应用

- **身份识别**，保存用户的登录信息，实现会话事务
- **广告追踪**，看过那些广告进行标记，方便之后推送