# 数字签名与证书

[TOC]

混合机密虽有机密性，离安全性还差的很远。

- 黑客虽然拿不到会话密钥，无法破解密文，但可以通过窃听收集足够多的密文，在尝试者修改、重组后发送给网站。因为没有完整性保证，服务器只能“照单全收”，然后就可以通过服务器的响应获取进一步的线索，最终就会破解出明文。
- 黑客可以伪造身份发布公钥。只要拿到了假的公钥，混合加密就完全失效了。

所以，在机密性的基础上还必须加上**完整性**、**身份认证**等特征，才能实现真正的安全。

## 摘要算法

完整性的手段主要是：**摘要算法**，也就是常说的散列函数、哈希函数。

可以把任意长度的数据“压缩”成固定长度，而且第一无二的“摘要”字符串，就好像是这段数据生成了一个数字“指纹”。

摘要算法理解成特殊的“**单向**”加密算法，它只有算法，没有密钥，加密后的数据无法解密，不能从摘要逆向推出原文。

摘要算法实际上是把数据从一个“大空间”映射到“小空间”，所以会存在“冲突”的可能性，就比如现实中的指纹一样，可能会有两份不同的原文对应相同的摘要。

“**好的摘要算法，要保证不同内容生成的数据尽可能的小**”

TLS推荐使用的是SHA-1的后继者SHA-2

## 完整性

发送的信息，后面加上SHA-2的摘要，就能保证数据的完整性。

服务端收到信息之后也计算以下消息的摘要，然后将加密的内容进行对比，如果一致，则说明消息是完整可信的，没有被修改。

如果是明文传输，那么黑客可以修改消息后把摘要也一起改了，网站还是鉴别不出完整性。

所以，**真正的完整性必须要建立在机密性之上**，在混合加密系统里用会话密钥加密消息和摘要，这样黑客就无法得知明文，也没有办法动手脚了。

这个术语叫：哈希消息认证（HMAC）

![](I:\myFuture\桌面资料\面试\学习图片\哈希消息认证码.png)

## 数字签名

机密算法结合摘要算法，通信可以说是比较安全了，但是还是存在漏洞，就是通信的两个端点。

黑客可以**伪装成网站**来窃取消息。而反过来，他也可以**伪装成你**，向网站发送消息、转账等消息，网站没有办法确认你的身份。

只要本人拥有的东西：非对称加密的“**私钥**”，使用私钥再加上摘要算法，就能是实现“**数字签名**”，同时实现“**身份认证**”和“**不可否认**”

**原理：**公钥私钥的用法反过来，之前是公钥加密，私钥解密，现在私钥加密，公钥解密。

但是，因为非对称加密效率太低了，所以私钥只加密原文的摘要，这样运算量就小的多，而且得到的数字签名也很小，方便保管和传输。

![](I:\myFuture\桌面资料\面试\学习图片\数字签名.png)

刚才的两个行为叫做：**签名**和“**验签**”

## 数字证书和CA

还存在一个“**公钥的信任**”问题，因为谁都可以发布公钥，我们还缺少防止黑客伪造公钥的手段，也就是说，怎么判断这个公钥就是你或者对应目标呢？

为了保证安全，找一个公认的可信第三方，**CA**（Certificate Authority，证书认证机构）。

CA的公钥的签名认真也是有格式的，不是简单的把公钥绑定在持有者身份上就完事了，还要包含序列号、用途、颁发者、有效时间等等，把这些打成一个包再签名，完整的证明公钥关联的各种信息，形成“**数字证书**”