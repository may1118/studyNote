# HTTP代理

[TOC]

## 代理服务

代理服务：服务本身不产生内容，而是处于中间位置转发上下游地请求和响应，具有双重身份

**作用：**

- 负载均衡
  - 轮询、一致性哈希等等，尽量把外部地流量合理地分散到多台源服务器，提高系统地整体资源利用率和性能。
  - ![](I:\myFuture\桌面资料\面试\学习图片\反向代理.png)

- 健康检查：使用“心跳”等机制监控后端服务器，发现有故障就及时“踢出”集群，保证服务高可用
- 安全防护：保护被代理地后端服务器，限制IP地址或流量，抵御网络攻击和过载
- 加密卸载：对外网使用SSL/TLS加密通信认证，而在安全地内网不加密，消除加解密成本
- 数据过滤：拦截上下行地数据，任意指定策略修改请求或者响应
- 内容缓存：暂存、复用服务器响应

## 代理有关字段

- “**Via**”：请求头/响应头都可以出现。每当报文经过一个代理节点，代理服务器就会把自身信息追加到字段的末尾，就像是经手人盖了一个章
  - 客户端发送请求经过了两个代理：“**Via：proxy1，proxy2**”，等到服务器返回响应报文的时候就要反过来走，头字段就是“**Via：proxy2，proxy1**”
  - ![](I:\myFuture\桌面资料\面试\学习图片\Via.png)

**Via**字段只解决了客户端和源服务器判断是否存在代理的问题，还不能知道对方的真实信息

但服务器IP地址应该是保密的，关系到企业的内网安全，所以一般不会让客户端知道。

"**X-Forwarded-For**"和"**X-Real-IP**"

- "**X-Forwarded-For**"：为谁而转发，追加的是请求发的IP地址。
- "**X-Real-IP**"获取客户端真实IP的手段，记录客户端IP地址