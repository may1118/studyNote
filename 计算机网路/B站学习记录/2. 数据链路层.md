# 数据链路层

[TOC]

**注意：**主机需要用5个层次，而路由器只需要下面三个层次，各个设备通过物理层的传输媒体互连

## 概念

- 链路：就是一个节点到相邻节点的一段线路，而中间件没有任何其他交换节点
- 数据链路：是指把通信协议的硬件和软件加到链路上，从而构成了数据链路
- 数据链路层以**帧**为单位传输和处理数据

## 封装成帧

将上层交付的内容添加添加帧头和帧尾，使之成为帧

帧头和帧尾包含重要的控制信息，帧定界标志

如果内容包含帧定界标志，会添加**转义符**

### 透明传输

数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样

## 差错检测

比特传输，检错码，封装到帧尾

- 奇偶校验
- CRC
  - 漏检率低

## 可靠传输

如何通过检验算法和检错码发现有错误，直接丢弃

如果需要实现可靠传输，那么需要**重新发送**

### 停止-等待协议

发送放发送一个数据帧，接收方接收到并检测正确发送一个**带序号**ACK，如果检测错误发送一个NAK；如果发送的数据帧在发送过程中丢失，那么会启动一个超时重传，如果大于规定时间，则重新发送；如果ACK/NAK丢失，也会启动超时重传机制，接收方会通过接收到的**序号**判断是否已经接受过了，如果接受过则直接丢弃，并且发送一个ACK

数据链路层的需要，只需要0和1即可，因为使停止-等待协议

### 回退N帧

**前提：**每次发送一个数据帧的效率使非常低的，而且采用停止-等待协议，那信道利用率会更加的低，那么我们可以一次性发送多个数据分组，接收方采用**累计确认**ACK（流水线传输）

发送窗口内某个已发送的数据分组产生超时重发时，其后续窗口内且已发送的数据分组也必须重传，这就是回退N协议名称的由来

### 选择重传

就是接收方的窗口不应该等于1，而也是维护一个有大小的窗口

（其实就是类似于TCP协议的保证安全的协议，也需要维护一个接收窗口和发送窗口）如果接收窗口的大小使1，那么就是停止-等待协议。

选择重传协议是为了使发送方**仅重传出现差错的分组**，接收方不能再采用累计确认，而需要对每个正确接收到的数据进行统一确认。

## 点对点PPP协议

**点对点链路层协议**

- 帧首部：5个字节
  - F：标志Flag
  - A：地址Address
  - C：控制Control
  - P：协议Protocal

- 帧尾部：3个字节
  - FCS：循环冗余校验字位CRC
  - F：标指Flag

### 透明传输

如果在帧的数据部分还有帧首部、帧尾部，需要进行处理

- 异步链路
  - 字节填充法，转义字符
- 同步链路
  - 比特填充法，插入比特0

## 静态划分信道

- 频分复用
- 时分复用
- 波分复用
- 码分复用CDM

## CSMA-CD

- 载波监听CS
  - 监听站点内是否还有其他站点发送帧
- 多址接入MA
  - 多个站点连接在一条总线上，竞争使用总线
- 碰撞检测CD
  - 每一个正在发送帧的站点发送检测碰撞
  - 一旦冲突，立即停止，等待时机，重新再发送

多个站点接入总线，如果监听到了总线是空闲，那么就发送帧，边发送还要边检测是否发生了碰撞，如果没有就发送帧的剩余部分。

**以太网规定最小帧长为64个字节**，即为512比特（即为争用期）

如果发送的帧数据非常少，那么必须加入一些填充字节，使帧长不少于64字节

以太网的最小帧长确保了主机可在帧发送完成之前检测到该帧的发送过程是否遭遇碰撞，如果在争用期没有发送碰撞，那么后续的数据一定不会发生碰撞，如果争用期内检测到了碰撞，就立即停止发送，这时已经发送出去的数据一定小于64字节，因此但凡小于64字节的帧都是由于碰撞而异常终止的无效帧。

**最大帧长为1518字节**，数据为1500字节

