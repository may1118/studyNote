# HTTP2.0多路复用

- **同域名**下所有通信都在单个连接上完成，同个域名只需要占用一个TCP连接，使用一个连接并行发送多个请求和响应。

## HTTP1.0

单个连接，每次连接只能发送一个请求，接收到相应之后就会断开请求

## HTTP1.1 keep-alive

一次连接，能够

TCP连接可以复用，但是还是回对单个域名限制6-8个的TCP连接请求限制。

**缺点：**

- 串行的文件传输。当请求a文件时，b文件只能等待，等待a连接到服务器、服务器处理文件、服务器返回文件，这三个步骤。
- 连接数过多。如果服务器设置了并发数为300，因为浏览器的限制，浏览器发起的最大请求数为6，也就是服务器能承受最高的并发为50，当51个人访问时，就需要等待某个请求处理完成。

## HTTP 2.0 多路复用

- 在HTTP1.1协议中，我们传输的request和response都是基于文本的，这样就会引发一个问题：所有的数据**必须按顺序传输**，不能并行传输，因为接收端并不知道这些内容的顺序，所以并行传输在HTTP1.1是不能实现的。

HTTP2.0 引入了二进制数据帧和流的概念，其中帧对数据进行顺序标识，这样浏览器收到数据之后，就可以按照顺序对数据进行合并，而不会出现合并后数据错乱的情况。同样时因为有了序列，服务器可以并行的传输数据，这就是流所作的事情。

![](I:\myFuture\桌面资料\面试\学习图片\HTTP2.png)

- 同一域名下请求都是基于流，也就是说同一域名不管访问多少文件，也只建立一路连接。同样服务器连接数为300，因为有了这个新特性，最大并发就可以提升300，比原来提升了6倍。

## 解决问题

- JS文件合并。我们现在优化的一个主要方向就是尽量的减少HTTP的请求树，对我们工程中的代码，研发时分模块开发，上线时我们会把所有的代码进行压缩合并，合成一个文件，这样不管多少模块，都请求一个文件，减少HTTP请求数，但是这样有一个非常严重的问题：**文件的缓存**。当我们由100个模块时，有一个模块改了东西，按照之前的方式，**整个文件浏览器都需要重新下载，不能被缓存**。现在我们有个HTTP/2了，**模块就可以单独的压缩上线，而不影响修改的模块**

- 多域名提高浏览器的下载速度。之前我们有一个优化就是把CSS文件和JS文件放在**2个域名下面**，这样浏览器就可以对这两个类型的文件进行同时下载，**避免了浏览器6个通道的限制**，这样做的缺点也是明显的

  - DNS解析时间变长
  - 增加了服务器的压力

  有了HTTP/2之后，根据上面讲的原理，我们就不用这么搞了，成本会更低。