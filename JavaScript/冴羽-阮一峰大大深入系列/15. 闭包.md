# 闭包

[TOC]

## 变量的作用域

- 全局变量
- 局部变量

Javascript语言的特殊之处，**就在于函数内部可以直接读取全局变量**。

```js
var n=999;

function f1(){
	alert(n);
}

f1(); // 999
```

当然，函数外部自然无法读取到函数内的局部变量

```js
function f1(){
    var n=999;
}

alert(n); // error
```

## 如何从外部读取局部变量？

```js
function f1(){

    var n=999;

    function f2(){
        alert(n); // 999
    }

}
```

f2被包括在函数f1内部，这时f1内部的所有局部变量，对f2都是可见的。但是，反过来就不行，f2内部的局部变量，对f1就是不可见的。这就是JavaScript语言特有的“**链式作用域**”结构，子对象会一级一级地向上寻找所有父对象地变量。所以，父对象地所有变量，对子对象都是可见地，反之则不成立。

**既然f2可以读取f1中地局部变量，那么只要把f2作为返回值，我们就可以在f1外部读取它的内部变量了。**

```js
function f1(){

    var n=999;

    function f2(){
        alert(n);
    }

    return f2;

}

var result=f1();

result(); // 999
```

## 闭包

**闭包就是能够读取其他函数内部变量地函数。**

由于在JavaScript语言中，**只有函数内部地子函数才能读取局部变量**，因此可以把闭包简单理解成“**定义在一个函数内部地函数**”。

## 注意点

- 闭包会使得函数中地变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页性能问题。在不适用地是否，手动释放
- 闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当成对象（object）使用，把闭包当作共有方法，把内部变量当作私有属性，这时一定要小心，不能随便改变父函数内部变量地值。